<!DOCTYPE html>
<html>
<head>
    <title>AI Fire & Gas Monitoring</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #111;
            color: white;
            text-align: center;
        }
        .card {
            background: #1e1e1e;
            padding: 20px;
            margin: 20px auto;
            width: 350px;
            border-radius: 10px;
        }
        canvas {
            max-width: 600px;
            margin: auto;
        }
    </style>
</head>

<body>
    <h1>ðŸ”¥ AI-Based Fire & Gas Monitoring System</h1>

    <div class="card">
        <p><b>Temperature:</b> <span id="temp">--</span> Â°C</p>
        <p><b>Gas Level:</b> <span id="gas">--</span></p>
        <p><b>Flame Detected:</b> <span id="flame">--</span></p>
        <p><b>Risk:</b> <span id="risk">--</span>%</p>
        <p><b>Status:</b> <span id="level">--</span></p>
    </div>

    <h2>ðŸ“ˆ Risk Trend (History)</h2>
    <canvas id="riskChart"></canvas>

    <script>
        const ctx = document.getElementById('riskChart').getContext('2d');

        const riskChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'Risk Percentage',
                    data: [],
                    borderWidth: 2,
                    tension: 0.3
                }]
            },
            options: {
                scales: {
                    y: {
                        min: 0,
                        max: 100
                    }
                }
            }
        });

        async function updateData() {
            const res = await fetch('/demo');
            const data = await res.json();

            document.getElementById('temp').innerText = data.temperature;
            document.getElementById('gas').innerText = data.gas;
            document.getElementById('flame').innerText = data.flame === 1 ? "YES" : "NO";
            document.getElementById('risk').innerText = data.risk_percentage;
            document.getElementById('level').innerText = data.risk_level;
        }

        async function updateGraph() {
            const res = await fetch('/risk-history');
            const history = await res.json();

            riskChart.data.labels = history.map((_, i) => i + 1);
            riskChart.data.datasets[0].data = history;
            riskChart.update();
        }

        setInterval(() => {
            updateData();
            updateGraph();
        }, 2000);
    </script>
</body>
</html>
